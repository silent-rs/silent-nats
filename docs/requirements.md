# silent-nats 需求整理

## 背景
Silent Odyssey 协议验证路线图第二阶段，需要基于 Silent 框架与 Tokio 运行时，构建兼容 NATS 文本协议的轻量级服务器，用于验证异步事件路由与发布订阅能力。

## 范围定义
- 支持 NATS 核心命令：`INFO`、`CONNECT`、`PING`、`PONG`、`SUB`、`UNSUB`、`PUB`、`MSG`
- 暂不实现 JetStream 与其他高级扩展
- 支持队列分组，实现同一队列内的订阅者负载均衡

## 功能需求
1. 启动 TCP 监听，接受客户端连接
2. 在连接建立后发送 `INFO` 消息，告知客户端服务器能力
3. 解析客户端发送的协议帧（`CONNECT`、`PING` 等），根据命令类型执行对应逻辑
4. 支持客户端订阅科目（Subject），维护订阅路由
5. 支持队列分组订阅，对同一队列内的多个订阅者进行轮询转发
6. 支持通配符匹配：`*` 匹配单个层级，`>` 匹配剩余层级
7. 支持 `PUB` 命令并向已订阅科目或匹配的科目推送 `MSG`
8. 支持 `PING`/`PONG` 保持连接
9. 支持 `UNSUB` 取消订阅，可包含最大消息数限制
10. 支持多客户端并发连接，消息分发基于 tokio 异步运行时

## 非功能性需求
- 使用 Rust 语言实现，依赖 Silent 框架组件
- 使用 `scru128` 生成会话或消息 ID，不使用 UUID
- 所有时间字段使用 `chrono::Local::now().naive_local()` 获取本地时间
- 启动流程与命令处理需要有错误日志与基础异常处理

## 约束与假设
- 运行环境具备 Tokio 异步运行时与 Silent 框架依赖
- 前期仅针对文本协议处理，不考虑 TLS
- 性能测试可使用 `nats-bench` 等外部工具

## 验收标准
- 依据 README 的示例，能够通过官方 `nats` CLI 进行基本的发布与订阅
- 通配符订阅能够正确接收匹配主题消息
- `PING`/`PONG`、`SUB`/`UNSUB` 等命令的协议交互符合 NATS 文本协议规范
